{% extends "base.html" %}
{% block content %}
<h4 align="center">MPGS Review Payment Details</h4>
<p></p>
<div class="container">
    <p>Please review below payment details before confirmation.</p>
    <hr>
    <h4>Payment Details</h4>
    <div class="row">
        <div class="col-25">
            <label for="orderId">orderId</label>
        </div>
        <div class="col-75">
            <p id="orderId" name="orderId" style="margin-bottom: 10px;display: block;">{{session['orderId']}}</p>
        </div>
    </div>
    <div class="row">
        <div class="col-25">
            <label for="amount">amount</label>
        </div>
        <div class="col-75">
            <p id="amount" name="amount" style="margin-bottom: 10px;display: block;">{{session['amount']}}</p>
        </div>
    </div>
    <div class="row">
        <div class="col-25">
            <label for="currency">currency</label>
        </div>
        <div class="col-75">
            <p id="currency" name="currency" style="margin-bottom: 10px;display: block;">{{session['currency']}}</p>
        </div>
    </div>
    <div class="row">
        <div class="col-25">
            <label for="currency">session_id</label>
        </div>
        <div class="col-75">
            <p id="currency" name="currency" style="margin-bottom: 10px;display: block;">{{session['session_id']}}</p>
        </div>
    </div>
    <div id="embed-target"> </div>
    <input type="button" value="Pay with Embedded Page" onclick="Checkout.showEmbeddedPage('#embed-target');"
        class="btn" />
    <input type="button" value="Pay with Payment Page" onclick="Checkout.showPaymentPage();" class="btn" />
</div>
</body>
<script async src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()">
</script>
<script src="https://gphk.gateway.mastercard.com/static/checkout/checkout.min.js" data-error="errorCallback"
    data-cancel="cancelCallback" data-beforeRedirect="Checkout.saveFormFields"
    data-afterRedirect="Checkout.restoreFormFields">
    </script>
<script type="text/javascript">
    var session_id = "{{ session_id }}";
    console.log('session_id: ' + session_id);
    function errorCallback(error) {
        console.log(JSON.stringify(error));
    }
    function cancelCallback() {
        console.log('Payment cancelled');
        // Reload the page to generate a new session ID - the old one is out of date as soon as the lightbox is invoked
        window.location.reload(true);
    }
    Checkout.configure({
        session: {
            id: session_id
        }
    });
    // This method preserves the current state of successIndicator and orderId, so they're not overwritten when we return to this page after redirect
    function getPageState() {
        return {
            session_id: session_id
        };
    }
    // This method is specifically for the full payment page option. Because we leave this page and return to it, we need to preserve the
    // state of successIndicator and orderId using the beforeRedirect/afterRedirect option
    function restorePageState(data) {
        console.log("afterRedirect: ", data);
        Checkout.showLightbox();
    }
    // This handles the response from Hosted Checkout and redirects to the appropriate endpoint
    function completeCallback(response) {
        console.log("COMPLETE: ", response);
    }
</script>
{% endblock %}